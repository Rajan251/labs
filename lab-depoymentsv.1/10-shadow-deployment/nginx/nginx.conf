# 10-shadow-deployment/nginx/nginx.conf
server {
    listen 80;
    server_name myapp.example.com;

    location / {
        # Mirror traffic to shadow backend
        mirror /mirror;
        proxy_pass http://backend-v1;
    }

    location /mirror {
        internal;
        proxy_pass http://backend-v2;
        # Ignore response from shadow
        proxy_pass_request_body on;
    }
}
