# Service Level Objectives (SLOs)
# Define SLOs for all critical services to drive alerting thresholds

services:
  # Example: API Gateway Service
  - name: api-gateway
    team: platform
    owner: platform-team@example.com
    slack_channel: "#platform-alerts"
    
    slos:
      availability:
        target: 99.9  # 99.9% uptime
        window: 30d   # 30-day rolling window
        error_budget: 0.1  # 0.1% downtime allowed
        measurement:
          metric: up{job="api-gateway"}
          threshold: "== 0"
          duration: 5m
      
      latency:
        target_p95: 200  # 95th percentile < 200ms
        target_p99: 500  # 99th percentile < 500ms
        window: 30d
        measurement:
          metric: http_request_duration_seconds{job="api-gateway"}
          percentile_95: 0.2
          percentile_99: 0.5
      
      error_rate:
        target: 99.5  # 99.5% success rate
        window: 30d
        error_budget: 0.5  # 0.5% error rate allowed
        measurement:
          success_metric: http_requests_total{job="api-gateway",status!~"5.."}
          total_metric: http_requests_total{job="api-gateway"}
          threshold: 0.005  # 0.5% error rate

  # Example: User Service
  - name: user-service
    team: backend
    owner: backend-team@example.com
    slack_channel: "#backend-alerts"
    
    slos:
      availability:
        target: 99.95
        window: 30d
        error_budget: 0.05
        measurement:
          metric: up{job="user-service"}
          threshold: "== 0"
          duration: 2m
      
      latency:
        target_p95: 150
        target_p99: 300
        window: 30d
        measurement:
          metric: http_request_duration_seconds{job="user-service"}
          percentile_95: 0.15
          percentile_99: 0.3
      
      error_rate:
        target: 99.9
        window: 30d
        error_budget: 0.1
        measurement:
          success_metric: http_requests_total{job="user-service",status!~"5.."}
          total_metric: http_requests_total{job="user-service"}
          threshold: 0.001

  # Example: Payment Service (Higher SLO)
  - name: payment-service
    team: payments
    owner: payments-team@example.com
    slack_channel: "#payments-alerts"
    
    slos:
      availability:
        target: 99.99  # Four nines
        window: 30d
        error_budget: 0.01
        measurement:
          metric: up{job="payment-service"}
          threshold: "== 0"
          duration: 1m
      
      latency:
        target_p95: 100
        target_p99: 200
        window: 30d
        measurement:
          metric: http_request_duration_seconds{job="payment-service"}
          percentile_95: 0.1
          percentile_99: 0.2
      
      error_rate:
        target: 99.99
        window: 30d
        error_budget: 0.01
        measurement:
          success_metric: http_requests_total{job="payment-service",status!~"5.."}
          total_metric: http_requests_total{job="payment-service"}
          threshold: 0.0001

  # Example: Database
  - name: postgres-primary
    team: database
    owner: dba-team@example.com
    slack_channel: "#database-alerts"
    
    slos:
      availability:
        target: 99.99
        window: 30d
        error_budget: 0.01
        measurement:
          metric: pg_up{instance="postgres-primary"}
          threshold: "== 0"
          duration: 1m
      
      query_latency:
        target_p95: 50  # 50ms
        target_p99: 100  # 100ms
        window: 30d
        measurement:
          metric: pg_stat_statements_mean_exec_time_seconds
          percentile_95: 0.05
          percentile_99: 0.1
      
      connection_saturation:
        target: 80  # Max 80% connection pool usage
        window: 30d
        measurement:
          metric: pg_stat_database_numbackends / pg_settings_max_connections
          threshold: 0.8

# Global SLO Configuration
global:
  default_window: 30d
  error_budget_burn_rate_fast: 14.4  # 5% of budget in 1 hour
  error_budget_burn_rate_slow: 6     # 5% of budget in 6 hours
  
  # Alert severity based on error budget consumption
  severity_mapping:
    critical: 50  # 50% of error budget consumed
    warning: 25   # 25% of error budget consumed
    info: 10      # 10% of error budget consumed

# SLO Reporting
reporting:
  frequency: weekly
  recipients:
    - engineering-leads@example.com
    - sre-team@example.com
  
  metrics:
    - slo_compliance_percentage
    - error_budget_remaining
    - error_budget_burn_rate
    - incidents_per_service
    - mttr_per_service
